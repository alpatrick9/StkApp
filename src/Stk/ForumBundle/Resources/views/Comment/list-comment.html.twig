{% extends "StkForumBundle::layout.html.twig" %}
{% block forum_body %}
    <h2>{{ subject.title }}</h2>
    <section class="align-right">
        <a href="{{ path('add_comment', {'id': subject.id}) }}" class="button">Ajouter des commentaires</a>
    </section>
    {% for comment in comments %}
        <fieldset class="custom_fieldset">
            <legend>créer le {{ comment.createdOn | date('d-M-Y') }} à {{ comment.createdOn | date('H:i') }}</legend>
            <p>{{ comment.comment }}</p>
        </fieldset>
    {% else %}
        <p> Aucun commentaire enregistré</p>
    {% endfor %}
    {% if comments|length > 0 %}
        <div class="pagination align-center">
            <ul>
                {% for p in range(1, nbPage) %}
                    <li{% if p == page %} class="active"{% endif %}>
                        <a href="{{ path('show_comment', {'id': subject.id, 'page': p}) }}">{{ p }}</a>
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}

    <script>
        function checkNotification() {
            $.ajax({
                url: "{{ path('comment_notification_check') }}",
                method: "post",
                data: {
                    size: {{ comments|length}},
                    subjectId: {{ subject.id }}
                },
                success: function (msg) {
                    if(JSON.parse(msg).status) {
                        document.location.href="{{ path('show_comment', {'id': subject.id}) }}";
                    }
                },
                error: function (msg) {
                    console.log('Error request Ajax');
                }
            })
            setTimeout(checkNotification,5000);
        }
        checkNotification();
    </script>
{% endblock  %}